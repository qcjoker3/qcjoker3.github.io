<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <title>Pr√©dictions</title>
    <link rel="stylesheet" href="style.css">
    <style>
        .encadre-background {
            background-color: #f0f8ff;
            padding: 30px 0;
        }

        .encadre-texte {
            font-family: 'Segoe UI', sans-serif;
            font-size: 1.1em;
            width: 60%;
            margin: 0 auto;
            padding: 15px;
            text-align: center;
            box-shadow: 0 2px 5px rgba(0,0,0,0);
            border-radius: 8px;
        }

        table {
            width: 80%;
            margin: auto;
            border-collapse: collapse;
            font-family: 'Segoe UI', sans-serif;
        }

        th, td {
            padding: 10px;
            text-align: center;
            border: 1px solid #aaa;
        }

        /* üéØ Largeurs personnalis√©es des colonnes */
        .col1 {
            width: 30%;
        }

        .col2 {
            width: 40%;
        }

        .col3 {
            width: 30%;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        thead {
            background-color: #4a90e2;
            color: white;
        }

        #yearSelect {
            font-size: 1em;
            padding: 6px;
            margin: 10px auto 20px auto;
        }

        #tableContainer {
            margin-top: 20px;
        }
    </style>
</head>
<body>

    <div id="header-placeholder"></div>

    <main>
        <section>
            <div class="encadre-texte">
                √Ä chaque d√©but d'ann√©e les strat√©gistes des grandes banques et fonds d'investissement d√©voilent leurs pr√©dictions sur le S&P 500 pour l'ann√©e √† venir. Ils sont pay√©s des millions par ann√©e et poss√®dent des mod√®les √©conom√©triques tr√®s avanc√©s. Ils devraient √™tre bons, n'est-ce pas‚ÄØ? Pourtant ann√©e apr√®s ann√©e ils sont toujours √† l'emploi de leur firme √† attendre leur ch√®que aux 2 semaines. Charlatants ou experts? Voyez par vous-m√™mes‚ÄØ!
            </div>

            <h2 style="text-align:center;">Pr√©dictions du S&P 500</h2>

           <div class="year-selector">
    <label for="yearSelect">üìÖ Ann√©e :</label>
    <select id="yearSelect" onchange="displayTable(this.value)">
        <option value="">-- S√©lectionner --</option>
        <option value="2020">2020</option>
        <option value="2021">2021</option>
        <option value="2022">2022</option>
        <option value="2023">2023</option>
        <option value="2024">2024</option>
    </select>
</div>

           
            <div id="tableContainer"></div>
        </section>
    </main>

    <footer style="text-align:center; margin-top: 40px;">
        <p>&copy; 2025 - Finoza</p>
    </footer>

    <script>
        fetch('header.html')
            .then(res => res.text())
            .then(data => {
                document.getElementById('header-placeholder').innerHTML = data;
            })
            .catch(error => console.error('Erreur de chargement du header‚ÄØ:', error));

<section id="sp500-section">
  <h2 style="text-align: center; font-family: Segoe UI;">Pr√©visions vs R√©alit√© du S&P 500</h2>
  
  <div class="sp500-controls" style="display: flex; justify-content: center; gap: 12px; margin-bottom: 16px;">
    <button id="sp500-prev">‚Üê Ann√©e pr√©c√©dente</button>
    <select id="sp500-select"></select>
    <button id="sp500-next">Ann√©e suivante ‚Üí</button>
  </div>
  
  <div style="max-width: 960px; margin: auto;">
    <canvas id="sp500-canvas" height="140"></canvas>
  </div>
</section>

            document.getElementById("tableContainer").innerHTML = tables[year] || "<p style='text-align:center;'>Aucune donn√©e disponible pour cette ann√©e.</p>";
        }
    </script>
<script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.3"></script>
<script>
document.addEventListener('DOMContentLoaded', () => {
  const dataByYear = {
    "2020": {
      real: 3756,
      institutions: ["Goldman Sachs", "JP Morgan", "Bank of America", "Morgan Stanley", "UBS",
        "Wells Fargo", "Barclays", "RBC", "Deutsche Bank", "Credit Suisse", "BMO", "Oppenheimer"],
      previsions: [3400, 3400, 3300, 3000, 3000, 3300, 3300, 3350, 3250, 3425, 3400, 3500]
    },
    "2021": {
      real: 4766,
      institutions: ["JP Morgan", "Goldman Sachs", "Oppenheimer", "Credit Suisse"],
      previsions: [3900, 4050, 4200, 4000]
    }
    // Tu peux ajouter ici tes donn√©es pour 2022, 2023, etc.
  };

  const years = Object.keys(dataByYear).sort();
  let currentIndex = 0;
  const $select = document.getElementById('sp500-select');
  const $prev = document.getElementById('sp500-prev');
  const $next = document.getElementById('sp500-next');
  const ctx = document.getElementById('sp500-canvas').getContext('2d');
  let chart;

  years.forEach(year => {
    const opt = document.createElement('option');
    opt.value = year;
    opt.textContent = year;
    $select.appendChild(opt);
  });

  const drawLine = (chart, yValue, label) => {
    const { ctx, chartArea, scales } = chart;
    const y = scales.y.getPixelForValue(yValue);
    ctx.save();
    ctx.setLineDash([6, 4]);
    ctx.strokeStyle = '#999';
    ctx.lineWidth = 2;
    ctx.beginPath();
    ctx.moveTo(chartArea.left, y);
    ctx.lineTo(chartArea.right, y);
    ctx.stroke();
    ctx.setLineDash([]);
    ctx.fillStyle = '#444';
    ctx.font = '12px Segoe UI';
    ctx.fillText(label, chartArea.right - ctx.measureText(label).width - 6, y - 6);
    ctx.restore();
  };

  Chart.register({
    id: 'customLine',
    afterDatasetsDraw: (chart) => {
      const year = years[currentIndex];
      const realValue = dataByYear[year].real;
      drawLine(chart, realValue, `R√©alit√©: ${realValue} pts`);
    }
  });

  const getDatasets = (previsions, real) => {
    const gap = previsions.map(p => Math.max(real - p, 0));
    const base = previsions.map(p => Math.min(p, real));
    return [
      {
        label: 'Pr√©vision',
        data: base,
        backgroundColor: 'rgba(54, 162, 235, 0.8)',
        stack: 'grp'
      },
      {
        label: '√âcart',
        data: gap,
        backgroundColor: 'rgba(255, 99, 132, 0.6)',
        stack: 'grp'
      }
    ];
  };

  function render(year) {
    const { institutions, previsions, real } = dataByYear[year];
    if (chart) chart.destroy();
    chart = new Chart(ctx, {
      type: 'bar',
      data: {
        labels: institutions,
        datasets: getDatasets(previsions, real)
      },
      options: {
        responsive: true,
        plugins: {
          title: {
            display: true,
            text: `Pr√©visions vs R√©alit√© (${year})`,
            font: { size: 18 }
          },
          legend: { position: 'bottom' }
        },
        scales: {
          x: { stacked: true },
          y: {
            stacked: true,
            title: {
              display: true,
              text: 'Points S&P 500'
            }
          }
        }
      },
      plugins: ['customLine']
    });

    $select.value = year;
    $prev.disabled = currentIndex === 0;
    $next.disabled = currentIndex === years.length - 1;
  }

  $select.addEventListener('change', e => {
    currentIndex = years.indexOf(e.target.value);
    render(e.target.value);
  });

  $prev.addEventListener('click', () => {
    if (currentIndex > 0) {
      currentIndex--;
      render(years[currentIndex]);
    }
  });

  $next.addEventListener('click', () => {
    if (currentIndex < years.length - 1) {
      currentIndex++;
      render(years[currentIndex]);
    }
  });

  render(years[currentIndex]);
});
</script>
</body>
</html>
