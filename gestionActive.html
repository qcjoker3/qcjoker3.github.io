<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Gestion Active vs. Passive - Finoza</title>
  <link rel="stylesheet" href="style.css" />
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>
<header class="container">
    <h1>Finoza</h1>
    <nav>
        <a href="index.html">Accueil</a>
        <a href="#services">Services</a>
        <a href="Pr√©dictions.html">Pr√©dictions</a>
        <a href="calculatrices.html">Calculatrices</a>
        <a href="gestionActive.html">Gestion active</a>
        <a href="decaissementRetraite.html">D√©caissement retraite</a>
        <a href="blog.html">Articles</a>
        <a href="#contact">Contact</a>
    </nav>
</header>

<div class="container">
    <h2>Gestion active contre gestion passive</h2>
    
    <section class="card">
      <h3>Le Duel des Philosophies</h3>
      <p>Laquelle de ces deux grandes approches d'investissement est la plus performante? Cette page compare des fonds communs de placement (gestion active) aux fonds n√©goci√©s en bourse (gestion passive) pour vous aider √† y voir plus clair.</p>
      <table class="comparison-table">
        <thead>
          <tr>
            <th><span class="icon">üß†</span>Gestion Active</th>
            <th><span class="icon">üìä</span>Gestion Passive</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td><strong>Objectif :</strong> Tenter de battre le march√© en s√©lectionnant les "meilleurs" titres.</td>
            <td><strong>Objectif :</strong> R√©pliquer la performance d'un indice de march√© (ex: S&P/TSX).</td>
          </tr>
          <tr>
            <td><strong>Frais :</strong> √âlev√©s (souvent 1.5% - 2.5%) pour payer l'√©quipe de gestion.</td>
            <td><strong>Frais :</strong> Tr√®s faibles (souvent 0.05% - 0.25%) car la gestion est automatis√©e.</td>
          </tr>
        </tbody>
      </table>
    </section>

    <section class="card" style="text-align: center;">
      <h3>Le Vrai Co√ªt des Frais de Gestion</h3>
      <p style="margin-bottom: 1.5rem;">Sur le long terme, une diff√©rence de 2% en frais peut r√©duire votre capital final de pr√®s de 50%. Visualisez l'impact concret sur votre propre portefeuille avec notre outil.</p>
      <a href="URL_VERS_VOTRE_CALCULATRICE" class="btn-primary" target="_blank">Calculer l'Impact des Frais</a>
    </section>
    
    <section class="card">
      <h2>Comparateur de Performance</h2>
      <p>S√©lectionnez une institution financi√®re, puis l'un de ses fonds pour le comparer √† un portefeuille de FNB passif √©quivalent.</p>
      
      <h3 style="margin-top: 2rem;">1. Choisissez une institution</h3>
      <div id="institutions" class="categories-container">
          <!-- Les boutons d'institutions seront inject√©s ici par le JS -->
      </div>
      
      <h3 style="margin-top: 1rem;">2. Choisissez un fonds</h3>
      <div id="fondsContainer" class="fonds-container">
          <!-- Les pastilles de fonds appara√Ætront ici -->
      </div>

      <!-- TABLEAU DE BORD DES R√âSULTATS -->
      <div id="results-dashboard" style="display: none;">
        <div class="dashboard-grid">
          <div class="metric-box">
            <div class="label">Frais de Gestion (RFG)</div>
            <div class="value active" id="active-fees">--</div>
            <div class="value passive" id="passive-fees">--</div>
          </div>
          <div class="metric-box">
            <div class="label">Rendt. Annuel</div>
            <div class="value active" id="active-return">--</div>
            <div class="value passive" id="passive-return">--</div>
          </div>
          <div class="metric-box">
            <div class="label">Capital Final (10k$)</div>
            <div class="value active" id="active-capital">--</div>
            <div class="value passive" id="passive-capital">--</div>
          </div>
          <div class="metric-box">
            <div class="label">Total Frais Pay√©s (10k$)</div>
            <div class="value active" id="active-fees-paid">--</div>
            <div class="value passive" id="passive-fees-paid">--</div>
          </div>
        </div>
      </div>
    </section>
    
    <!-- GRAPHIQUES -->
    <div id="charts-container" style="display: none;">
      <section class="card">
        <h3 id="croissanceChartTitle">Croissance de 10 000 $</h3>
        <canvas id="croissanceChart"></canvas>
      </section>
      <section class="card">
        <h3>Rendements annuels compar√©s</h3>
        <canvas id="rendementAnnuelChart"></canvas>
      </section>
    </div>

    <section class="card">
      <h2>Conclusion : Que Faire?</h2>
      <p>Les donn√©es historiques d√©montrent souvent que les frais √©lev√©s des fonds actifs nuisent √† leur performance √† long terme. Pour la plupart des investisseurs, une approche passive avec des FNB √† faibles co√ªts est une strat√©gie simple et tr√®s efficace.</p>
      <h3 style="margin-top: 1.5rem;">Prochaines √©tapes :</h3>
      <ul style="margin-left: 20px; line-height: 1.8;">
        <li>Ouvrir un compte de courtage en ligne (ex: Disnat, Questrade, Wealthsimple Trade).</li>
        <li>Explorer des FNB de r√©partition d'actifs comme XGRO, VGRO (80% actions) ou XBAL, VBAL (60% actions).</li>
        <li>Utiliser notre <a href="decaissementRetraite.html">calculateur de d√©caissement</a> pour planifier votre retraite avec des hypoth√®ses de rendements r√©alistes.</li>
      </ul>
    </section>
  </div>

<script>
document.addEventListener("DOMContentLoaded", async () => {

    // --- UTILITIES ---
    const formatCurrency = (value) => value.toLocaleString('fr-CA', { style: 'currency', currency: 'CAD', maximumFractionDigits: 0 });
    const chartOptions = (yAxisTitle) => ({
        responsive: true,
        maintainAspectRatio: false,
        plugins: { legend: { position: 'top' } },
        scales: {
            y: { ticks: { callback: value => `${value.toFixed(0)}${yAxisTitle.includes('%') ? '%' : '$'}` }, title: { display: true, text: yAxisTitle } },
            x: { grid: { display: false } }
        }
    });

    // --- DATA LOADING ---
    async function loadData() {
        try {
            const resp = await fetch('fonds.json');
            if (!resp.ok) throw new Error(`Erreur de chargement: ${resp.statusText}`);
            return await resp.json();
        } catch (error) {
            console.error("Impossible de charger les donn√©es des fonds:", error);
            return null;
        }
    }

    // --- CALCULATIONS ---
    function calculateGrowthAndFees(initial, monthlyReturns, annualFee) {
        let value = initial;
        let totalFeesPaid = 0;
        const growth = [{ x: 'D√©part', y: initial }];
        const monthlyFeeRate = (annualFee ?? 0) / 100 / 12;

        const sortedMonths = Object.keys(monthlyReturns).sort();
        
        for (const month of sortedMonths) {
            if (monthlyReturns[month] === null) continue;
            
            const feeAmount = value * monthlyFeeRate;
            totalFeesPaid += feeAmount;
            value -= feeAmount;
            value *= (1 + monthlyReturns[month] / 100);
            growth.push({ x: month, y: value });
        }
        return { endValue: value, growth, totalFeesPaid };
    }

    function calculateAnnualizedReturn(growthData) {
        if (growthData.length <= 1) return 0;
        const endValue = growthData[growthData.length - 1].y;
        const startValue = growthData[0].y;
        const totalMonths = growthData.length - 1;
        if (startValue === 0 || totalMonths === 0) return 0;
        const totalYears = totalMonths / 12;
        return (Math.pow(endValue / startValue, 1 / totalYears) - 1) * 100;
    }

    function calculateAnnualReturns(monthlyReturns) {
        const annuals = {};
        for (const month in monthlyReturns) {
            if (monthlyReturns[month] === null) continue;
            const year = month.split('-')[0];
            if (!annuals[year]) annuals[year] = 1;
            annuals[year] *= (1 + monthlyReturns[month] / 100);
        }
        for (const year in annuals) {
            annuals[year] = (annuals[year] - 1) * 100;
        }
        return annuals;
    }

    // --- DOM & CHARTING ---
    let croissanceChartInstance, rendementAnnuelChartInstance;

    function displayComparison(data, fondKey) {
        const fondActif = data.fonds_actifs[fondKey];
        if (!fondActif) { console.error(`Fonds actif non trouv√©: ${fondKey}`); return; }
        
        const keyFondPassif = fondActif.composition_passif?.[0];
        const fondPassif = data.fonds_passifs[keyFondPassif];
        if (!fondPassif) { console.error(`Fonds passif non trouv√©: ${keyFondPassif}`); return; }

        const activeMonths = Object.keys(fondActif.rendements_mensuels);
        const passiveMonths = Object.keys(fondPassif.rendements_mensuels);
        const commonMonths = activeMonths.filter(month => passiveMonths.includes(month));
        
        const rendementsActif = {};
        const rendementsPassif = {};
        commonMonths.forEach(month => {
            rendementsActif[month] = fondActif.rendements_mensuels[month];
            rendementsPassif[month] = fondPassif.rendements_mensuels[month];
        });

        const initialInvestment = 10000;
        const activeFee = fondActif.frais ?? 2.1; 
        const passiveFee = fondPassif.frais ?? 0.2;

        const activeData = calculateGrowthAndFees(initialInvestment, rendementsActif, activeFee);
        const passiveData = calculateGrowthAndFees(initialInvestment, rendementsPassif, passiveFee);

        document.getElementById('active-fees').textContent = `${activeFee.toFixed(2)}%`;
        document.getElementById('passive-fees').textContent = `${passiveFee.toFixed(2)}%`;
        document.getElementById('active-return').textContent = `${calculateAnnualizedReturn(activeData.growth).toFixed(2)}%`;
        document.getElementById('passive-return').textContent = `${calculateAnnualizedReturn(passiveData.growth).toFixed(2)}%`;
        document.getElementById('active-capital').textContent = formatCurrency(activeData.endValue);
        document.getElementById('passive-capital').textContent = formatCurrency(passiveData.endValue);
        document.getElementById('active-fees-paid').textContent = formatCurrency(activeData.totalFeesPaid);
        document.getElementById('passive-fees-paid').textContent = formatCurrency(passiveData.totalFeesPaid);

        const years = (commonMonths.length) / 12;
        document.getElementById('croissanceChartTitle').textContent = `Croissance de 10 000 $ sur ${years.toFixed(1)} ans`;
        updateCroissanceChart(activeData.growth, passiveData.growth, fondActif.nom, keyFondPassif);
        
        const rendActifAnnuel = calculateAnnualReturns(rendementsActif);
        const rendPassifAnnuel = calculateAnnualReturns(rendementsPassif);
        const annees = Object.keys(rendActifAnnuel).sort();
        updateRendementAnnuelChart(annees.map(y => rendActifAnnuel[y]), annees.map(y => rendPassifAnnuel[y]), annees, fondActif.nom, keyFondPassif);

        document.getElementById('results-dashboard').style.display = 'block';
        document.getElementById('charts-container').style.display = 'block';
    }

    function updateCroissanceChart(activeData, passiveData, activeName, passiveName) {
        const ctx = document.getElementById('croissanceChart').getContext('2d');
        if (croissanceChartInstance) croissanceChartInstance.destroy();
        croissanceChartInstance = new Chart(ctx, {
            type: 'line',
            data: {
                datasets: [
                    { label: activeName, data: activeData, borderColor: 'rgba(79, 70, 229, 1)', backgroundColor: 'rgba(79, 70, 229, 0.1)', fill: 'origin', tension: 0.2, pointRadius: 0 },
                    { label: passiveName, data: passiveData, borderColor: 'rgba(13, 148, 136, 1)', backgroundColor: 'rgba(13, 148, 136, 0.1)', fill: 'origin', tension: 0.2, pointRadius: 0 }
                ]
            },
            options: chartOptions('Valeur du portefeuille')
        });
    }

    function updateRendementAnnuelChart(activeReturns, passiveReturns, labels, activeName, passiveName) {
        const ctx = document.getElementById('rendementAnnuelChart').getContext('2d');
        if (rendementAnnuelChartInstance) rendementAnnuelChartInstance.destroy();
        rendementAnnuelChartInstance = new Chart(ctx, {
            type: 'bar',
            data: {
                labels,
                datasets: [
                    { label: activeName, data: activeReturns, backgroundColor: 'rgba(79, 70, 229, 0.8)' },
                    { label: passiveName, data: passiveReturns, backgroundColor: 'rgba(13, 148, 136, 0.8)' }
                ]
            },
            options: chartOptions('Rendement (%)')
        });
    }

    // --- INITIALIZATION ---
    const data = await loadData();
    if (!data) {
        console.error("Les donn√©es des fonds n'ont pas pu √™tre initialis√©es.");
        return;
    }

    const institutionsContainer = document.getElementById('institutions');
    const fondsContainer = document.getElementById('fondsContainer');

    Object.keys(data.institutions).forEach(inst => {
        const btn = document.createElement('button');
        btn.className = 'pastille institution';
        btn.textContent = inst;
        btn.dataset.institution = inst;
        institutionsContainer.appendChild(btn);
    });

    institutionsContainer.addEventListener('click', (e) => {
        if (!e.target.classList.contains('institution')) return;
        const selectedInst = e.target.dataset.institution;
        
        document.querySelectorAll('.institution').forEach(btn => btn.classList.remove('selected'));
        e.target.classList.add('selected');

        fondsContainer.innerHTML = '';
        data.institutions[selectedInst].forEach(fondKey => {
            const pill = document.createElement('button');
            pill.className = 'pastille fond';
            pill.textContent = data.fonds_actifs[fondKey]?.nom || fondKey;
            pill.dataset.fondKey = fondKey;
            fondsContainer.appendChild(pill);
        });
        
        document.getElementById('results-dashboard').style.display = 'none';
        document.getElementById('charts-container').style.display = 'none';

        if (fondsContainer.firstChild) {
            fondsContainer.firstChild.click();
        }
    });

    fondsContainer.addEventListener('click', (e) => {
        if (!e.target.classList.contains('fond')) return;
        const selectedFondKey = e.target.dataset.fondKey;
        document.querySelectorAll('.fond').forEach(pill => pill.classList.remove('selected'));
        e.target.classList.add('selected');
        displayComparison(data, selectedFondKey);
    });
    
    if (institutionsContainer.firstChild) {
        institutionsContainer.firstChild.click();
    }
});
</script>
</body>
</html>

